pytest
============================================================

* ã‚µãƒ¼ãƒ‰ãƒ‘ãƒ¼ãƒ†ã‚£ãƒ©ã‚¤ãƒ–ãƒ©ãƒª https://pypi.org/project/pytest/
* :command:`pip install pytest`

.. ãšã£ã¨æ˜”ã¯py.test

pytestã§æ›¸ããƒ†ã‚¹ãƒˆ
============================================================

1. ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œã‚‹
2. ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã¨ã—ã¦ã€é–¢æ•°ã‚’æ›¸ã
3. assertæ–‡

pytestã®è¦å‰‡ã«å¾“ã£ãŸãƒ•ã‚¡ã‚¤ãƒ«
--------------------------------------------------

* ``test_`` ã§å§‹ã¾ã‚‹Pythonãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ

.. ä¸€èˆ¬ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯ tests ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ä¸‹

.. code-block::

    .
    â”œâ”€â”€ fizzbuzz.py
    â””â”€â”€ test_fizzbuzz.py

pytestã®è¦å‰‡ã«å¾“ã£ãŸé–¢æ•°
--------------------------------------------------

* ``test_`` ã§å§‹ã¾ã‚‹é–¢æ•°ã‚’æ›¸ã

.. code-block:: python
    :caption: test_fizzbuzz.py

    def test_3ã®å€æ•°ã®ã¨ãã¯Fizzã‚’è¿”ã™():
        ...

Pythonã®assertæ–‡
--------------------------------------------------

* ``assert å¼``
* å¼ãŒ ``True`` ã¨è©•ä¾¡ã•ã‚Œã‚‹ã‹ã‚’æ¤œè¨¼

https://docs.python.org/ja/3/reference/simple_stmts.html#the-assert-statement

assertæ–‡ã®ä¾‹
--------------------------------------------------

.. code-block:: pycon

    >>> assert 1 == 1
    >>> assert 1 == 2
    Traceback (most recent call last):
      File "<stdin>", line 1, in <module>
    AssertionError

3Aã§ç†è§£ã™ã‚‹pytest
--------------------------------------------------

.. code-block:: python
    :caption: test_fizzbuzz.py

    def test_3ã®å€æ•°ã®ã¨ãã¯Fizzã‚’è¿”ã™():
        number = 3  # Arrange
        assert fizzbuzz(number) == "Fizz"  # Act & Assert

ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ :command:`pytest -v`
--------------------------------------------------

.. code-block::

    .
    â”œâ”€â”€ fizzbuzz.py
    â””â”€â”€ test_fizzbuzz.py

.. code-block::

    $ pytest -v
    ============================= test session starts ==============================
    
    collected 5 items

    ============================== 5 passed in 0.01s ===============================

failã—ãŸãƒ†ã‚¹ãƒˆï¼ˆ15ã§Fizzã‚’è¿”ã—ãŸï¼‰
--------------------------------------------------

.. code-block::

    test_fizzbuzz.py::test_15ã®å€æ•°ã®ã¨ãã¯FizzBuzzã‚’è¿”ã™ FAILED             [ 20%]

    =================================== FAILURES ===================================
    __________________________ test_15ã®å€æ•°ã®ã¨ãã¯FizzBuzzã‚’è¿”ã™ ___________________________

        def test_15ã®å€æ•°ã®ã¨ãã¯FizzBuzzã‚’è¿”ã™():
    >       assert fizzbuzz(15) == "FizzBuzz"
    E       AssertionError: assert 'Fizz' == 'FizzBuzz'
    E         - FizzBuzz
    E         + Fizz

* assertæ–‡ã ãŒã€diffãŒåˆ†ã‹ã‚Šã‚„ã™ã„

pytestã¯ **assertæ–‡ã‚’æ‹¡å¼µ**
--------------------------------------------------

* ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã«ä½¿ã†ã®ã¯assertæ–‡ã ã‘ã¨ **ç°¡å˜**ã€ã‹ã¤ã€failä¸‹ãƒ†ã‚¹ãƒˆã®diffãŒ **åˆ†ã‹ã‚Šã‚„ã™ã„**
* å®Ÿã¯pytestãŒassertæ–‡ã‚’æ›¸ãæ›ãˆã¦ã€åˆ†ã‹ã‚Šã‚„ã™ã„diffã‚’å®Ÿç¾ã—ã¦ã„ã‚‹ï¼ˆ`assertion rewriting <https://docs.pytest.org/en/latest/how-to/writing_plugins.html#assertion-rewriting>`__ï¼‰

pytestã§docstringã®å¯¾è©±ä¾‹ã‚‚å®Ÿè¡Œã§ãã‚‹ğŸƒâ€â™‚ï¸
--------------------------------------------------

* :command:`pytest --doctest-modules`
* https://docs.pytest.org/en/stable/how-to/doctest.html

ãƒ‘ãƒ©ãƒ¡ã‚¿åŒ–ãƒ†ã‚¹ãƒˆ
============================================================

.. code-block:: python

    def test_3ã®å€æ•°ã®ã¨ãã¯Fizzã‚’è¿”ã™():
        ...

3ã®å€æ•°ãªã‚‰Fizz
--------------------------------------------------

* 3
* 6
* 9

å€‹åˆ¥ã«ãƒ†ã‚¹ãƒˆã®é–¢æ•°ã‚’æ›¸ãï¼Ÿ
--------------------------------------------------

.. code-block:: python

    def test_3ã®å€æ•°ã®ã¨ãã¯Fizzã‚’è¿”ã™_3ã®å ´åˆ():
        ...

    def test_3ã®å€æ•°ã®ã¨ãã¯Fizzã‚’è¿”ã™_6ã®å ´åˆ():
        ...

``@pytest.mark.parametrize`` ã‚’ä½¿ãŠã†
--------------------------------------------------

.. code-block:: python

    @pytest.mark.parametrize("number", [3, 6])
    def test_3ã®å€æ•°ã®ã¨ãã¯Fizzã‚’è¿”ã™(number):
        assert fizzbuzz(number) == "Fizz"

1ã¤ã®é–¢æ•°ã€è¤‡æ•°ã®ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹
--------------------------------------------------

.. code-block::

    $ pytest -v

    test_fizzbuzz.py::test_3ã®å€æ•°ã®ã¨ãã¯Fizzã‚’è¿”ã™[3] PASSED               [ 40%]
    test_fizzbuzz.py::test_3ã®å€æ•°ã®ã¨ãã¯Fizzã‚’è¿”ã™[6] PASSED               [ 60%]

å€‹åˆ¥ã«æ›¸ã„ãŸã®ã¨åŒã˜çµæœãŒå¾—ã‚‰ã‚Œã‚‹

ãƒ¢ãƒƒã‚¯
============================================================

TODO è¦‹ç›´ã—

éƒ¨å“ã”ã¨ã«ãƒ†ã‚¹ãƒˆã™ã‚‹
--------------------------------------------------

* å…¨ã¦é€šã•ãªã„ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰
* ã‚ã‚‹éƒ¨å“ã®å‘¼ã³å‡ºã—æ–¹ã‚’æ¤œè¨¼
* éƒ¨å“è‡ªä½“ã¯å¾¹åº•çš„ã«æ¤œè¨¼

.. TODO ä¾‹ã‚’å‡ºã™

ãƒ¢ãƒƒã‚¯ã‚’ä½¿ã£ã¦éƒ¨å“ã‚’ãƒ†ã‚¹ãƒˆ
--------------------------------------------------

* ã‚ã‚‹éƒ¨å“ã‚’ãƒ¢ãƒƒã‚¯ã«ã™ã‚‹
* ãƒ¢ãƒƒã‚¯ã¯å‘¼ã³å‡ºã•ã‚Œæ–¹ã‚’è¦šãˆã¦ã„ã‚‹ -> æ¤œè¨¼ã§ãã‚‹
* ãƒ¢ãƒƒã‚¯ã«ã—ãŸéƒ¨å“è‡ªä½“ã¯ã€å˜ä½“ãƒ†ã‚¹ãƒˆã§å¾¹åº•çš„ã«æ¤œè¨¼
