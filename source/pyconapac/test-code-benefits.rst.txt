ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ãŒæ›¸ã‘ã‚‹ãƒ¡ãƒªãƒƒãƒˆ
============================================================

.. First, let's talk about the benefits of being able to write test code.

.. ã¾ãšã€ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ãŒæ›¸ã‘ã‚‹ã¨ã©ã‚“ãªã„ã„ã“ã¨ãŒã‚ã‚‹ã‹ã‚’è©±ã—ã¦ã„ãã¾ã™

ä¸€åº¦æ›¸ã„ãŸã‚³ãƒ¼ãƒ‰ã¯æ”¹å–„ï¼ˆå¤‰æ›´ï¼‰ã‚’å…ã‚Œãªã„
============================================================

* æŒã¦ã‚‹çŸ¥è­˜ã‚’å…¨ã¦å‹•å“¡ã—ã¦æ›¸ã„ãŸãŒã€ã‚ˆã‚Šé©åˆ‡ãªæ–‡æ³•ã‚’çŸ¥ã‚‰ãªã‹ã£ãŸ
* **æ–°ã—ãçŸ¥ã£ãŸæ›¸ãæ–¹** ã§æ›¸ãç›´ã—ãŸã„ â¡ï¸ å­¦ã³ã«ãªã‚Šã€Pythonã®åŠ›ãŒã¤ãğŸ’ª

.. Personally, I don't think there's ever a time when you shouldn't improve the code you've written.
    You might have written the code using all the knowledge you have, but you may not have known a more appropriate syntax.
    I often find that rewriting code to be more efficient is a great learning experience, and it builds your proficiency in Python.

.. ç§ã€æ€ã†ã‚“ã§ã™ã‘ã©ã€ä¸€åº¦æ›¸ã„ãŸã‚³ãƒ¼ãƒ‰ã‚’æ”¹å–„ã—ãªã„ã“ã¨ã£ã¦ãªã„ã‚“ã˜ã‚ƒãªã„ã‹ãªã¨ã€‚
    æŒã¦ã‚‹çŸ¥è­˜ã‚’å…¨ã¦ä½¿ã£ã¦æ›¸ã„ãŸã‚³ãƒ¼ãƒ‰ã ãŒã€ã‚ˆã‚Šé©åˆ‡ãªæ–‡æ³•ã‚’çŸ¥ã‚‰ãªã‹ã£ãŸã€‚
    ã‚ˆã‚Šã‚ˆã„ã‚„ã‚Šæ–¹ã§æ›¸ãç›´ã—ãŸã„ã¨æ€ã„ã¾ã™ã—ã€å®Ÿéš›æ›¸ãç›´ã™ã¨å­¦ã³ã«ãªã‚Šã€Pythonã®åŠ›ãŒã¤ãã¨çµŒé¨“ã—ã¦ãã¾ã—ãŸã€‚

.. PythonãŒãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚¢ãƒƒãƒ—ã—ã¦æ–‡æ³•è‡ªä½“ãŒé€²åŒ–

ä¾‹ï¼šFizzBuzz
--------------------------------------------------

.. code-block:: python

    def fizzbuzz(number: int) -> str:
        if number % 3 == 0 and number % 5 == 0:
            return "FizzBuzz"
        elif number % 3 == 0:
            return "Fizz"
        elif number % 5 == 0:
            return "Buzz"
        else:
            return str(number)

https://pycamp.pycon.jp/textbook/2_intro.html#fizzbuzz ãƒªã‚¹ãƒˆ2.14

.. Let's take the example of the FizzBuzz program.
    It's a familiar programming task where you return "Fizz" for multiples of 3 and so on.

.. ä¾‹ã¯FizzBuzzã®ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã§ã™ã€‚
    3ã®å€æ•°ã®ã¨ãã¯Fizzã€5ã®å€æ•°ã®ã¨ãã¯Buzzã¨è¿”ã™ã¨ã„ã†ã€ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã§ã¯ãŠãªã˜ã¿ã®èª²é¡Œã§ã™ã­

Structural Pattern Matching (Python 3.10ã€œ)
--------------------------------------------------

.. code-block:: python

    def fizzbuzz(number: int) -> str:
        match number % 3, number % 5:
            case 0, 0: return "FizzBuzz"
            case 0, _: return "Fizz"
            case _, 0: return "Buzz"
            case _, _: return str(number)

https://gihyo.jp/news/report/01/pyconjp2021/0002

è£ã§ã€Œ`Introduction to Structural Pattern Matching <https://2023-apac.pycon.jp/timetable?id=DXWXGJ>`__ã€

.. With Python 3.10's Structural Pattern Matching, you can write it like this! It's quite surprising.

.. ã“ã®FizzBuzzã§ã™ãŒã€Python 3.10ã‹ã‚‰ä½¿ãˆã‚‹ã‚ˆã†ã«ãªã£ãŸStructural Pattern Matchingã‚’ä½¿ã†ã¨
    ã“ã‚“ãªæ„Ÿã˜ã§ã‚¹ãƒƒã‚­ãƒªæ›¸ã‘ã¡ã‚ƒã†ï¼ ã³ã£ãã‚Šã§ã™ã‚ˆã­

æ›¸ãæ›ãˆã§æŒ¯ã‚‹èˆã„ã‚’å¤‰ãˆã¦ã„ãªã„ã ã‚ã†ã‹ï¼Ÿ
============================================================

**ä¸å®‰** ã«å¯¾å‡¦ã™ã‚‹ã„ãã¤ã‹ã®ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ

.. However, there's a fear that you might change the behavior unintentionally with the rewrite.
    There are various approaches to address this fear.

.. ã§ã™ãŒã€æ›¸ãæ›ãˆã§æŒ¯ã‚‹èˆã„ã‚’å¤‰ãˆã¡ã‚ƒã£ã¦ã„ã‚‹ã‹ã‚‚ã¨ã„ã†ä¸å®‰ã‚’æ„Ÿã˜ã¾ã™ã€‚
    ã“ã®ä¸å®‰ã«ã¯ã„ã‚ã‚“ãªã‚¢ãƒ—ãƒ­ãƒ¼ãƒãŒã‚ã‚‹ã¨æ€ã„ã¾ã™ã€‚

.. fearï¼ˆä¸å®‰ï¼‰

(A) ç¥ˆã‚‹ ğŸ™
--------------------------------------------------

* ğŸ™ğŸ™ã€Œã©ã†ã‹å¤‰ã‚ã£ã¦ã„ã¾ã›ã‚“ã‚ˆã†ã«ã€ğŸ™ğŸ™
* æŒ¯ã‚‹èˆã„ã‚’å¤‰ãˆã¦ã„ãªã„ã‹ä¸å®‰ã ãŒã€ *ä½•ã‚‚ç¢ºèªã¯ã—ãªã„*

.. One approach is to pray for the fear.
    "I'm rewriting it, but please don't change anything!"
    (While the fear might diminish,) IN fact you're not really confirming anything.

.. ä¾‹ãˆã°ç¥ˆã‚Šã§ä¸å®‰ã«ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã€‚
    æ›¸ãæ›ãˆã‚‹ã‚“ã ã‘ã©å¤‰ã‚ã£ã¦ã„ãªã„ã§ãã‚Œï¼ã¨ã„ã†ç¥ˆã‚Šã§ã™ã€‚
    ä¸å®‰ã¯è–„ã¾ã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ãŒã€ä½•ã‚‚ç¢ºèªã—ã¦ã„ã¾ã›ã‚“ã­

(B) æ‰‹ã§å‹•ä½œç¢ºèª âœ‹
--------------------------------------------------

* ä¾‹ãˆã°å¯¾è©±çš„ã« ``fizzbuzz`` é–¢æ•°ã‚’å®Ÿè¡Œ

.. code-block:: pycon

    >>> from fizzbuzz import fizzbuzz  # doctest: +SKIP
    >>> fizzbuzz(15)  # doctest: +SKIP
    'FizzBuzz'

* å®‰å¿ƒã§ãã‚‹ãŒã€ *é–¢æ•°ã®æ•°ãŒå¢—ãˆã¦* ã„ãã¨ç¾å®Ÿçš„ã§ã¯ãªã•ãã†

.. Another approach is to manually check.
    Start the interpreter, import fizzbuzz, pass 15(fifteen), and see if it returns "FizzBuzz".
    (If it behaves as expected, you can feel at ease.
    However,) as the number of functions you want to check increases, it might become challenging.

.. åˆ¥ã®ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã¨ã—ã¦ã€æ‰‹ã§å‹•ä½œç¢ºèªã§ã™ã€‚
    ã‚¤ãƒ³ã‚¿ãƒ—ãƒªã‚¿ã‚’ç«‹ã¡ä¸Šã’ã¦ã€fizzbuzzã‚’importã—ã¦15ã‚’æ¸¡ã—ã¦FizzBuzzã¨è¿”ã‚‹ã€‚
    ã“ã‚Œã¯æœŸå¾…é€šã‚Šã®å‹•ãã ï¼ã¨å®‰å¿ƒã§ãã‚‹ã¨æ€ã„ã¾ã™ã€‚
    ã§ã™ãŒã€ç¢ºèªã—ãŸã„é–¢æ•°ã®æ•°ãŒå¢—ãˆã¦ã„ãã¨å¤§å¤‰ãã†ã§ã™ã­

(C) ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã„ã¦å‹•ä½œç¢ºèª ğŸ¤–
--------------------------------------------------

* ã“ã®ç™ºè¡¨ã®æœ¬é¡Œ
* ã€Œæ‰‹ã§å‹•ä½œç¢ºèªã€ã® **è‡ªå‹•åŒ–** ï¼ˆãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã‚’æ›¸ãï¼‰
* ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã§ä½¿ã†éƒ¨å“ã®ã‚³ãƒ¼ãƒ‰ã¯ã€ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’æ›¸ã„ã¦å‹•ä½œç¢ºèªã™ã‚‹ã¨ã„ã†è€ƒãˆæ–¹

.. Third approach is to write code to automate the manual check.
    This is the main topic of this presentation.
    We'll write what's called test code.
    (Considering it as a component that the program uses, we'll use the program to confirm its behavior.)

.. 3ã¤ã®ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã€ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã„ã¦å‹•ä½œç¢ºèªã—ã¾ã—ã‚‡ã†ã€‚
    ã“ã‚ŒãŒã“ã®ç™ºè¡¨ã®æœ¬é¡Œã§ã™ã€‚
    æ‰‹ã§ã®ç¢ºèªã‚’è‡ªå‹•åŒ–ã—ã¦ã„ãã€‚ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã¨å‘¼ã°ã‚Œã‚‹ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã„ã¦ã„ãã¾ã™ã€‚
    ãƒ—ãƒ­ã‚°ãƒ©ãƒ ãŒä½¿ã†éƒ¨å“ãªã®ã§ã€ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã§ä½¿ã£ã¦å‹•ä½œç¢ºèªã™ã‚‹ã¨è€ƒãˆã¦ã„ã¾ã™

.. ã€Œå˜ä½“ãƒ†ã‚¹ãƒˆã€ã¯Appendixï¼Ÿ

ç”¨èªç´¹ä»‹(1/2) å®Ÿè¡Œçµæœ
--------------------------------------------------

ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€ã„ãšã‚Œã‹

* **pass** ï¼ˆå…¨ã¦é€šã‚‹ãƒ»æˆåŠŸï¼‰
* fail ï¼ˆ1ã¤ã§ã‚‚å¤±æ•—ãƒ»è½ã¡ã‚‹ï¼‰

.. Let's introduce some terminology here.
    When you execute a set of test codes, there are only two outcomes: pass or fail.
    "Pass" means all tests have succeeded.
    If even one test fails, the entire set is marked as "fail".

.. ã“ã“ã§ç”¨èªã‚’ç´¹ä»‹ã—ã¾ã—ã‚‡ã†ã€‚
    ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã®é›†åˆã‚’å…¨éƒ¨å®Ÿè¡Œã—ãŸã‚‰passã‹failã—ã‹ã‚ã‚Šã¾ã›ã‚“ã€‚
    passã¯ãƒ†ã‚¹ãƒˆãŒå…¨ã¦æˆåŠŸã—ãŸã¨ã„ã†ã“ã¨ã§ã™ã€‚
    ãƒ†ã‚¹ãƒˆãŒ1ã¤ã§ã‚‚å¤±æ•—ã™ã‚‹ã¨ãƒ†ã‚¹ãƒˆã‚‚failã¨ãªã‚Šã¾ã™ã€‚

ç”¨èªç´¹ä»‹(2/2) å€¤
--------------------------------------------------

.. code-block:: pycon
    :caption: ã‹ã—ã“ã¾ã£ãŸæ›¸ãæ–¹

    >>> actual = fizzbuzz(15)  # ãƒ†ã‚¹ãƒˆå¯¾è±¡ã‚’å®Ÿè¡Œã—ãŸå€¤ # doctest: +SKIP
    >>> expected = "FizzBuzz"  # æœŸå¾…çµæœ
    >>> actual == expected
    True

.. In formal way, The value returned by the subject you want to test is called "actual",
    and the result you expect is called "expected".
    You verify that actual and expected are equal.

.. ã‚‚ã†1ã¤ã€ã‹ã—ã“ã¾ã£ãŸæ›¸ãæ–¹ã§ã™ãŒï¼ˆformal wayï¼‰ã€
    ãƒ†ã‚¹ãƒˆã—ãŸã„å¯¾è±¡ã‚’å®Ÿè¡Œã—ãŸå€¤ã¯actualã€
    æœŸå¾…ã™ã‚‹çµæœã‚’expectedã¨å‘¼ã‚“ã§ã€
    actualã¨expectedãŒç­‰ã—ã„ã“ã¨ã‚’æ¤œè¨¼ã—ã¦ã„ã¾ã™

ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ãŒã‚ã‚‹ã¨
============================================================

.. list-table:: ``actual == expected`` ã‚’ **ç°¡å˜ã«ç¢ºèª** ã§ãã‚‹

    * - actual
      - expected
    * - ``fizzbuzz(3)``
      - ``"Fizz"``
    * - ``fizzbuzz(5)``
      - ``"Buzz"``
    * - ``fizzbuzz(15)``
      - ``"FizzBuzz"``

.. I'll tell you a bit later how to write test code,
    but even if you imagine having test code, it brings so many benefits.
    For example, there's a test that checks if passing 3 to fizzbuzz returns the string "Fizz".

.. ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã‚’ã©ã†æ›¸ãã‹ã¯ã‚‚ã†å°‘ã—å…ˆã§ãŠä¼ãˆã—ã¾ã™ãŒã€
    ä»®ã«ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ãŒã‚ã‚‹ã¨ã“ã‚“ãªã«ã„ã„ã“ã¨ãŒã‚ã‚Šã¾ã™ã‚ˆã€‚
    ä¾‹ãˆã°ã€fizzbuzzã«3ã‚’æ¸¡ã™ã¨æ–‡å­—åˆ—ã®Fizz

ä¸å®‰ã¯é€€å±ˆã«å¤‰ã‚ã‚‹
--------------------------------------------------

* å®Ÿè£…ä¸­ã€ä»•æ§˜ã‚’æº€ãŸã™ **å‹•ä½œã™ã‚‹ã‚³ãƒ¼ãƒ‰** ã§ã‚ã‚‹ã¨ç¢ºèªã§ãã‚‹ğŸ™Œ
* æ›¸ãæ›ãˆã‚‹éš›ã‚‚ã€ãŠã‹ã—ãã—ã¦ã„ãŸã‚‰æ°—ä»˜ã‘ã‚‹ ğŸ™Œï¼ˆ*å›å¸°ãƒ†ã‚¹ãƒˆ*ï¼‰

.. When the test passes, it means you have code that works as specified.
    If you accidentally mess something up, the test will fail, and you'll notice.

.. ãƒ†ã‚¹ãƒˆãŒpassã¨ã„ã†ã“ã¨ã¯ã€ä»•æ§˜ã‚’æº€ãŸã™å‹•ä½œã™ã‚‹ã‚³ãƒ¼ãƒ‰ã¨ã„ã†ã“ã¨ã§ã™ã€‚
    ãŠã‹ã—ãã—ã¦ã—ã¾ã£ãŸã‚‰ãƒ†ã‚¹ãƒˆãŒfailã—ã¦æ°—ã¥ã‘ã¾ã™ã€‚
    ã€Œä¸å®‰ã¯é€€å±ˆã«å¤‰ã‚ã‚‹ã€ã¨ã¯ã‚ˆãè¨€ã£ãŸã‚‚ã®ã ã¨æ€ã„ã¾ã™

.. ãƒ†ã‚¹ãƒˆãŒå…¨ã¦passã™ã‚Œã°ã€æ›¸ãæ›ãˆã§å¤‰æ›´ã—ã¦ã„ãªã„
.. ãƒ†ã‚¹ãƒˆãŒ1ã¤ã§ã‚‚failã—ãŸã‚‰ã€æ›¸ãæ›ãˆã§ä½•ã‹ãŠã‹ã—ãã—ã¦ã—ã¾ã£ãŸï¼ˆæ°—ã¥ã‘ã‚‹ï¼‰

æ›¸ãã‚³ãƒ¼ãƒ‰ã¯å¢—ãˆã¦ã„ã‚‹ã€ã‘ã‚Œã©
--------------------------------------------------

* å®Ÿè£…ã«åŠ ãˆã¦ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã‚‚æ›¸ã
* ã§ã‚‚ã€ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ **<< ãƒ¡ãƒªãƒƒãƒˆ** ã ã¨æ€ã†ã‹ã‚‰ã€ğŸ“£ç·´ç¿’ã—ã¦æ›¸ã‘ã‚‹ã‚ˆã†ã«ãªã‚‹ã‚“ã ï¼

.. However, you have to write both the test code and the implementation. (It's a bit tough.)
    Everything has its pros and cons, and I believe the benefits far outweigh the drawbacks from my experience.
    So, in this talk, I'm encouraging you to give writing test code a try.

.. ãŸã ã€ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã¨å®Ÿè£…ã¨ã€ä¸¡æ–¹æ›¸ã‹ãªã‘ã‚Œã°ãªã‚Šã¾ã›ã‚“ã€‚ï¼ˆã¤ã‚‰ã„ã¨ã“ã‚ã ãªï¼‰
    ã©ã‚“ãªã‚‚ã®ã«ãƒ¡ãƒªãƒƒãƒˆã¨ãƒ‡ãƒ¡ãƒªãƒƒãƒˆã‚‚ã‚ã‚‹ã¨æ€ã„ã¾ã™ã€‚
    ç§ã¯çµŒé¨“ã‹ã‚‰ãƒ¡ãƒªãƒƒãƒˆãŒãƒ‡ãƒ¡ãƒªãƒƒãƒˆã‚’å¤§ããä¸Šå›ã‚‹ã¨æ€ã£ã¦ã„ã‚‹ã®ã§ã€ã“ã®ãƒˆãƒ¼ã‚¯ã§ã¯ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã„ã¦ã¿ã¾ã—ã‚‡ã†ã¨ä¼ãˆã¦ã„ã¾ã™

ğŸ¥Ÿãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã¯Pythonã®åŠ›ã‚’ã¤ã‘ã‚‹ä¸‹åœ°ï¼ˆN=1ï¼‰
============================================================

* ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã«ã‚ˆã‚Šã€ã€Œã“ã®å®Ÿè£…ã¯ä»•æ§˜ã‚’æº€ãŸã™ **å‹•ä½œ** ã™ã‚‹ã‚³ãƒ¼ãƒ‰ã€ã¨ **ç¢ºèª** ã§ãã‚‹
* æ–°ã—ãçŸ¥ã£ãŸæ–‡æ³•ã‚’è©¦ã—ã¦æ›¸ãæ›ãˆã‚‹ã¨ãã€ **èª¤** ã£ã¦æŒ¯ã‚‹èˆã„ã‚’å¤‰ãˆã¦ã—ã¾ã£ã¦ã‚‚ **æ°—ã¥ã‘ã‚‹**

.. To summarize what we've covered so far,
    With test code, you can confirm that the implementation works as specified.
    (Even when trying out new syntax you've learned and rewriting,)
    you can catch if you unintentionally change the behavior.

.. ã“ã“ã¾ã§ã‚’ã¾ã¨ã‚ã¾ã™ã¨ã€
    ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ãŒã‚ã‚‹ã¨ã€å®Ÿè£…ã¯ä»•æ§˜ã‚’æº€ãŸã™å‹•ä½œã™ã‚‹ã‚³ãƒ¼ãƒ‰ã¨ç¢ºèªã§ãã¾ã™ã€‚
    æ–°ã—ãçŸ¥ã£ãŸæ–‡æ³•ã‚’è©¦ã—ã¦æ›¸ãæ›ãˆã‚‹ã¨ãã€èª¤ã£ã¦æŒ¯ã‚‹èˆã„ã‚’å¤‰ãˆã¦ã—ã¾ã£ãŸã¨ãã‚‚æ°—ã¥ã‘ã¾ã™ã€‚
